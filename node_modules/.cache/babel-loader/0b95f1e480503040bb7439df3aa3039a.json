{"ast":null,"code":"import cursor from './cursor';\nimport { data, dataref, change, insert, remove } from './data';\nimport { initializeEventConfig, events } from './events';\nimport hover from './hover';\nimport finalize from './finalize';\nimport initialize from './initialize';\nimport renderToImageURL from './render-to-image-url';\nimport renderToCanvas from './render-to-canvas';\nimport renderToSVG from './render-to-svg';\nimport { resizeRenderer } from './render-size';\nimport runtime from './runtime';\nimport { scale } from './scale';\nimport { resizeView, initializeResize, viewWidth, viewHeight } from './size';\nimport { getState, setState } from './state';\nimport timer from './timer';\nimport defaultTooltip from './tooltip';\nimport trap from './trap';\nimport { asyncCallback, Dataflow } from 'vega-dataflow';\nimport { error, extend, inherits, hasOwnProperty, stringValue } from 'vega-util';\nimport { CanvasHandler, Scenegraph, renderModule, RenderType } from 'vega-scenegraph';\n/**\n * Create a new View instance from a Vega dataflow runtime specification.\n * The generated View will not immediately be ready for display. Callers\n * should also invoke the initialize method (e.g., to set the parent\n * DOM element in browser-based deployment) and then invoke the run\n * method to evaluate the dataflow graph. Rendering will automatically\n * be peformed upon dataflow runs.\n * @constructor\n * @param {object} spec - The Vega dataflow runtime specification.\n */\n\nexport default function View(spec, options) {\n  var view = this;\n  options = options || {};\n  Dataflow.call(view);\n  if (options.loader) view.loader(options.loader);\n  if (options.logger) view.logger(options.logger);\n  if (options.logLevel != null) view.logLevel(options.logLevel);\n  view._el = null;\n  view._elBind = null;\n  view._renderType = options.renderer || RenderType.Canvas;\n  view._scenegraph = new Scenegraph();\n  var root = view._scenegraph.root; // initialize renderer, handler and event management\n\n  view._renderer = null;\n  view._tooltip = options.tooltip || defaultTooltip, view._redraw = true;\n  view._handler = new CanvasHandler().scene(root);\n  view._preventDefault = false;\n  view._timers = [];\n  view._eventListeners = [];\n  view._resizeListeners = []; // initialize event configuration\n\n  view._eventConfig = initializeEventConfig(spec.eventConfig); // initialize dataflow graph\n\n  var ctx = runtime(view, spec, options.functions);\n  view._runtime = ctx;\n  view._signals = ctx.signals;\n  view._bind = (spec.bindings || []).map(function (_) {\n    return {\n      state: null,\n      param: extend({}, _)\n    };\n  }); // initialize scenegraph\n\n  if (ctx.root) ctx.root.set(root);\n  root.source = ctx.data.root.input;\n  view.pulse(ctx.data.root.input, view.changeset().insert(root.items)); // initialize background color\n\n  view._background = options.background || ctx.background || null; // initialize view size\n\n  view._width = view.width();\n  view._height = view.height();\n  view._viewWidth = viewWidth(view, view._width);\n  view._viewHeight = viewHeight(view, view._height);\n  view._origin = [0, 0];\n  view._resize = 0;\n  view._autosize = 1;\n  initializeResize(view); // initialize cursor\n\n  cursor(view); // initialize hover proessing, if requested\n\n  if (options.hover) view.hover(); // initialize DOM container(s) and renderer\n\n  if (options.container) view.initialize(options.container, options.bind);\n}\nvar prototype = inherits(View, Dataflow); // -- DATAFLOW / RENDERING ----\n\nprototype.evaluate = async function (encode, prerun, postrun) {\n  // evaluate dataflow and prerun\n  await Dataflow.prototype.evaluate.call(this, encode, prerun); // render as needed\n\n  if (this._redraw || this._resize) {\n    try {\n      if (this._renderer) {\n        if (this._resize) {\n          this._resize = 0;\n          resizeRenderer(this);\n        }\n\n        await this._renderer.renderAsync(this._scenegraph.root);\n      }\n\n      this._redraw = false;\n    } catch (e) {\n      this.error(e);\n    }\n  } // evaluate postrun\n\n\n  if (postrun) asyncCallback(this, postrun);\n  return this;\n};\n\nprototype.dirty = function (item) {\n  this._redraw = true;\n  this._renderer && this._renderer.dirty(item);\n}; // -- GET / SET ----\n\n\nprototype.container = function () {\n  return this._el;\n};\n\nprototype.scenegraph = function () {\n  return this._scenegraph;\n};\n\nprototype.origin = function () {\n  return this._origin.slice();\n};\n\nfunction lookupSignal(view, name) {\n  return hasOwnProperty(view._signals, name) ? view._signals[name] : error('Unrecognized signal name: ' + stringValue(name));\n}\n\nprototype.signal = function (name, value, options) {\n  var op = lookupSignal(this, name);\n  return arguments.length === 1 ? op.value : this.update(op, value, options);\n};\n\nprototype.background = function (_) {\n  if (arguments.length) {\n    this._background = _;\n    this._resize = 1;\n    return this;\n  } else {\n    return this._background;\n  }\n};\n\nprototype.width = function (_) {\n  return arguments.length ? this.signal('width', _) : this.signal('width');\n};\n\nprototype.height = function (_) {\n  return arguments.length ? this.signal('height', _) : this.signal('height');\n};\n\nprototype.padding = function (_) {\n  return arguments.length ? this.signal('padding', _) : this.signal('padding');\n};\n\nprototype.autosize = function (_) {\n  return arguments.length ? this.signal('autosize', _) : this.signal('autosize');\n};\n\nprototype.renderer = function (type) {\n  if (!arguments.length) return this._renderType;\n  if (!renderModule(type)) error('Unrecognized renderer type: ' + type);\n\n  if (type !== this._renderType) {\n    this._renderType = type;\n\n    this._resetRenderer();\n  }\n\n  return this;\n};\n\nprototype.tooltip = function (handler) {\n  if (!arguments.length) return this._tooltip;\n\n  if (handler !== this._tooltip) {\n    this._tooltip = handler;\n\n    this._resetRenderer();\n  }\n\n  return this;\n};\n\nprototype.loader = function (loader) {\n  if (!arguments.length) return this._loader;\n\n  if (loader !== this._loader) {\n    Dataflow.prototype.loader.call(this, loader);\n\n    this._resetRenderer();\n  }\n\n  return this;\n};\n\nprototype.resize = function () {\n  // set flag to perform autosize\n  this._autosize = 1; // touch autosize signal to ensure top-level ViewLayout runs\n\n  return this.touch(lookupSignal(this, 'autosize'));\n};\n\nprototype._resetRenderer = function () {\n  if (this._renderer) {\n    this._renderer = null;\n    this.initialize(this._el, this._elBind);\n  }\n}; // -- SIZING ----\n\n\nprototype._resizeView = resizeView; // -- EVENT HANDLING ----\n\nprototype.addEventListener = function (type, handler, options) {\n  var callback = handler;\n\n  if (!(options && options.trap === false)) {\n    // wrap callback in error handler\n    callback = trap(this, handler);\n    callback.raw = handler;\n  }\n\n  this._handler.on(type, callback);\n\n  return this;\n};\n\nprototype.removeEventListener = function (type, handler) {\n  var handlers = this._handler.handlers(type),\n      i = handlers.length,\n      h,\n      t; // search registered handlers, remove if match found\n\n\n  while (--i >= 0) {\n    t = handlers[i].type;\n    h = handlers[i].handler;\n\n    if (type === t && (handler === h || handler === h.raw)) {\n      this._handler.off(t, h);\n\n      break;\n    }\n  }\n\n  return this;\n};\n\nprototype.addResizeListener = function (handler) {\n  var l = this._resizeListeners;\n\n  if (l.indexOf(handler) < 0) {\n    // add handler if it isn't already registered\n    // note: error trapping handled elsewhere, so\n    // no need to wrap handlers here\n    l.push(handler);\n  }\n\n  return this;\n};\n\nprototype.removeResizeListener = function (handler) {\n  var l = this._resizeListeners,\n      i = l.indexOf(handler);\n\n  if (i >= 0) {\n    l.splice(i, 1);\n  }\n\n  return this;\n};\n\nfunction findOperatorHandler(op, handler) {\n  var t = op._targets || [],\n      h = t.filter(function (op) {\n    var u = op._update;\n    return u && u.handler === handler;\n  });\n  return h.length ? h[0] : null;\n}\n\nfunction addOperatorListener(view, name, op, handler) {\n  var h = findOperatorHandler(op, handler);\n\n  if (!h) {\n    h = trap(this, function () {\n      handler(name, op.value);\n    });\n    h.handler = handler;\n    view.on(op, null, h);\n  }\n\n  return view;\n}\n\nfunction removeOperatorListener(view, op, handler) {\n  var h = findOperatorHandler(op, handler);\n  if (h) op._targets.remove(h);\n  return view;\n}\n\nprototype.addSignalListener = function (name, handler) {\n  return addOperatorListener(this, name, lookupSignal(this, name), handler);\n};\n\nprototype.removeSignalListener = function (name, handler) {\n  return removeOperatorListener(this, lookupSignal(this, name), handler);\n};\n\nprototype.addDataListener = function (name, handler) {\n  return addOperatorListener(this, name, dataref(this, name).values, handler);\n};\n\nprototype.removeDataListener = function (name, handler) {\n  return removeOperatorListener(this, dataref(this, name).values, handler);\n};\n\nprototype.preventDefault = function (_) {\n  if (arguments.length) {\n    this._preventDefault = _;\n    return this;\n  } else {\n    return this._preventDefault;\n  }\n};\n\nprototype.timer = timer;\nprototype.events = events;\nprototype.finalize = finalize;\nprototype.hover = hover; // -- DATA ----\n\nprototype.data = data;\nprototype.change = change;\nprototype.insert = insert;\nprototype.remove = remove; // -- SCALES --\n\nprototype.scale = scale; // -- INITIALIZATION ----\n\nprototype.initialize = initialize; // -- HEADLESS RENDERING ----\n\nprototype.toImageURL = renderToImageURL;\nprototype.toCanvas = renderToCanvas;\nprototype.toSVG = renderToSVG; // -- SAVE / RESTORE STATE ----\n\nprototype.getState = getState;\nprototype.setState = setState;","map":{"version":3,"sources":["C:/NewReactResume/resm/node_modules/vega-view/src/View.js"],"names":["cursor","data","dataref","change","insert","remove","initializeEventConfig","events","hover","finalize","initialize","renderToImageURL","renderToCanvas","renderToSVG","resizeRenderer","runtime","scale","resizeView","initializeResize","viewWidth","viewHeight","getState","setState","timer","defaultTooltip","trap","asyncCallback","Dataflow","error","extend","inherits","hasOwnProperty","stringValue","CanvasHandler","Scenegraph","renderModule","RenderType","View","spec","options","view","call","loader","logger","logLevel","_el","_elBind","_renderType","renderer","Canvas","_scenegraph","root","_renderer","_tooltip","tooltip","_redraw","_handler","scene","_preventDefault","_timers","_eventListeners","_resizeListeners","_eventConfig","eventConfig","ctx","functions","_runtime","_signals","signals","_bind","bindings","map","_","state","param","set","source","input","pulse","changeset","items","_background","background","_width","width","_height","height","_viewWidth","_viewHeight","_origin","_resize","_autosize","container","bind","prototype","evaluate","encode","prerun","postrun","renderAsync","e","dirty","item","scenegraph","origin","slice","lookupSignal","name","signal","value","op","arguments","length","update","padding","autosize","type","_resetRenderer","handler","_loader","resize","touch","_resizeView","addEventListener","callback","raw","on","removeEventListener","handlers","i","h","t","off","addResizeListener","l","indexOf","push","removeResizeListener","splice","findOperatorHandler","_targets","filter","u","_update","addOperatorListener","removeOperatorListener","addSignalListener","removeSignalListener","addDataListener","values","removeDataListener","preventDefault","toImageURL","toCanvas","toSVG"],"mappings":"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","sourcesContent":["import cursor from './cursor';\nimport {data, dataref, change, insert, remove} from './data';\nimport {initializeEventConfig, events} from './events';\nimport hover from './hover';\nimport finalize from './finalize';\nimport initialize from './initialize';\nimport renderToImageURL from './render-to-image-url';\nimport renderToCanvas from './render-to-canvas';\nimport renderToSVG from './render-to-svg';\nimport {resizeRenderer} from './render-size';\nimport runtime from './runtime';\nimport {scale} from './scale';\nimport {resizeView, initializeResize, viewWidth, viewHeight} from './size';\nimport {getState, setState} from './state';\nimport timer from './timer';\nimport defaultTooltip from './tooltip';\nimport trap from './trap';\n\nimport {asyncCallback, Dataflow} from 'vega-dataflow';\nimport {error, extend, inherits, hasOwnProperty, stringValue} from 'vega-util';\nimport {\n  CanvasHandler, Scenegraph,\n  renderModule, RenderType\n} from 'vega-scenegraph';\n\n/**\n * Create a new View instance from a Vega dataflow runtime specification.\n * The generated View will not immediately be ready for display. Callers\n * should also invoke the initialize method (e.g., to set the parent\n * DOM element in browser-based deployment) and then invoke the run\n * method to evaluate the dataflow graph. Rendering will automatically\n * be peformed upon dataflow runs.\n * @constructor\n * @param {object} spec - The Vega dataflow runtime specification.\n */\nexport default function View(spec, options) {\n  var view = this;\n  options = options || {};\n\n  Dataflow.call(view);\n  if (options.loader) view.loader(options.loader);\n  if (options.logger) view.logger(options.logger);\n  if (options.logLevel != null) view.logLevel(options.logLevel);\n\n  view._el = null;\n  view._elBind = null;\n  view._renderType = options.renderer || RenderType.Canvas;\n  view._scenegraph = new Scenegraph();\n  var root = view._scenegraph.root;\n\n  // initialize renderer, handler and event management\n  view._renderer = null;\n  view._tooltip = options.tooltip || defaultTooltip,\n  view._redraw = true;\n  view._handler = new CanvasHandler().scene(root);\n  view._preventDefault = false;\n  view._timers = [];\n  view._eventListeners = [];\n  view._resizeListeners = [];\n\n  // initialize event configuration\n  view._eventConfig = initializeEventConfig(spec.eventConfig);\n\n  // initialize dataflow graph\n  var ctx = runtime(view, spec, options.functions);\n  view._runtime = ctx;\n  view._signals = ctx.signals;\n  view._bind = (spec.bindings || []).map(function(_) {\n    return {\n      state: null,\n      param: extend({}, _)\n    };\n  });\n\n  // initialize scenegraph\n  if (ctx.root) ctx.root.set(root);\n  root.source = ctx.data.root.input;\n  view.pulse(\n    ctx.data.root.input,\n    view.changeset().insert(root.items)\n  );\n\n  // initialize background color\n  view._background = options.background || ctx.background || null;\n\n  // initialize view size\n  view._width = view.width();\n  view._height = view.height();\n  view._viewWidth = viewWidth(view, view._width);\n  view._viewHeight = viewHeight(view, view._height);\n  view._origin = [0, 0];\n  view._resize = 0;\n  view._autosize = 1;\n  initializeResize(view);\n\n  // initialize cursor\n  cursor(view);\n\n  // initialize hover proessing, if requested\n  if (options.hover) view.hover();\n\n  // initialize DOM container(s) and renderer\n  if (options.container) view.initialize(options.container, options.bind);\n}\n\nvar prototype = inherits(View, Dataflow);\n\n// -- DATAFLOW / RENDERING ----\n\nprototype.evaluate = async function(encode, prerun, postrun) {\n  // evaluate dataflow and prerun\n  await Dataflow.prototype.evaluate.call(this, encode, prerun);\n\n  // render as needed\n  if (this._redraw || this._resize) {\n    try {\n      if (this._renderer) {\n        if (this._resize) {\n          this._resize = 0;\n          resizeRenderer(this);\n        }\n        await this._renderer.renderAsync(this._scenegraph.root);\n      }\n      this._redraw = false;\n    } catch (e) {\n      this.error(e);\n    }\n  }\n\n  // evaluate postrun\n  if (postrun) asyncCallback(this, postrun);\n\n  return this;\n};\n\nprototype.dirty = function(item) {\n  this._redraw = true;\n  this._renderer && this._renderer.dirty(item);\n};\n\n// -- GET / SET ----\n\nprototype.container = function() {\n  return this._el;\n};\n\nprototype.scenegraph = function() {\n  return this._scenegraph;\n};\n\nprototype.origin = function() {\n  return this._origin.slice();\n};\n\nfunction lookupSignal(view, name) {\n  return hasOwnProperty(view._signals, name)\n    ? view._signals[name]\n    : error('Unrecognized signal name: ' + stringValue(name));\n}\n\nprototype.signal = function(name, value, options) {\n  var op = lookupSignal(this, name);\n  return arguments.length === 1\n    ? op.value\n    : this.update(op, value, options);\n};\n\nprototype.background = function(_) {\n  if (arguments.length) {\n    this._background = _;\n    this._resize = 1;\n    return this;\n  } else {\n    return this._background;\n  }\n};\n\nprototype.width = function(_) {\n  return arguments.length ? this.signal('width', _) : this.signal('width');\n};\n\nprototype.height = function(_) {\n  return arguments.length ? this.signal('height', _) : this.signal('height');\n};\n\nprototype.padding = function(_) {\n  return arguments.length ? this.signal('padding', _) : this.signal('padding');\n};\n\nprototype.autosize = function(_) {\n  return arguments.length ? this.signal('autosize', _) : this.signal('autosize');\n};\n\nprototype.renderer = function(type) {\n  if (!arguments.length) return this._renderType;\n  if (!renderModule(type)) error('Unrecognized renderer type: ' + type);\n  if (type !== this._renderType) {\n    this._renderType = type;\n    this._resetRenderer();\n  }\n  return this;\n};\n\nprototype.tooltip = function(handler) {\n  if (!arguments.length) return this._tooltip;\n  if (handler !== this._tooltip) {\n    this._tooltip = handler;\n    this._resetRenderer();\n  }\n  return this;\n};\n\nprototype.loader = function(loader) {\n  if (!arguments.length) return this._loader;\n  if (loader !== this._loader) {\n    Dataflow.prototype.loader.call(this, loader);\n    this._resetRenderer();\n  }\n  return this;\n};\n\nprototype.resize = function() {\n  // set flag to perform autosize\n  this._autosize = 1;\n  // touch autosize signal to ensure top-level ViewLayout runs\n  return this.touch(lookupSignal(this, 'autosize'));\n};\n\nprototype._resetRenderer = function() {\n  if (this._renderer) {\n    this._renderer = null;\n    this.initialize(this._el, this._elBind);\n  }\n};\n\n// -- SIZING ----\nprototype._resizeView = resizeView;\n\n// -- EVENT HANDLING ----\n\nprototype.addEventListener = function(type, handler, options) {\n  var callback = handler;\n  if (!(options && options.trap === false)) {\n    // wrap callback in error handler\n    callback = trap(this, handler);\n    callback.raw = handler;\n  }\n  this._handler.on(type, callback);\n  return this;\n};\n\nprototype.removeEventListener = function(type, handler) {\n  var handlers = this._handler.handlers(type),\n      i = handlers.length, h, t;\n\n  // search registered handlers, remove if match found\n  while (--i >= 0) {\n    t = handlers[i].type;\n    h = handlers[i].handler;\n    if (type === t && (handler === h || handler === h.raw)) {\n      this._handler.off(t, h);\n      break;\n    }\n  }\n  return this;\n};\n\nprototype.addResizeListener = function(handler) {\n  var l = this._resizeListeners;\n  if (l.indexOf(handler) < 0) {\n    // add handler if it isn't already registered\n    // note: error trapping handled elsewhere, so\n    // no need to wrap handlers here\n    l.push(handler);\n  }\n  return this;\n};\n\nprototype.removeResizeListener = function(handler) {\n  var l = this._resizeListeners,\n      i = l.indexOf(handler);\n  if (i >= 0) {\n    l.splice(i, 1);\n  }\n  return this;\n};\n\nfunction findOperatorHandler(op, handler) {\n  var t = op._targets || [],\n      h = t.filter(function(op) {\n            var u = op._update;\n            return u && u.handler === handler;\n          });\n  return h.length ? h[0] : null;\n}\n\nfunction addOperatorListener(view, name, op, handler) {\n  var h = findOperatorHandler(op, handler);\n  if (!h) {\n    h = trap(this, function() { handler(name, op.value); });\n    h.handler = handler;\n    view.on(op, null, h);\n  }\n  return view;\n}\n\nfunction removeOperatorListener(view, op, handler) {\n  var h = findOperatorHandler(op, handler);\n  if (h) op._targets.remove(h);\n  return view;\n}\n\nprototype.addSignalListener = function(name, handler) {\n  return addOperatorListener(this, name, lookupSignal(this, name), handler);\n};\n\nprototype.removeSignalListener = function(name, handler) {\n  return removeOperatorListener(this, lookupSignal(this, name), handler);\n};\n\nprototype.addDataListener = function(name, handler) {\n  return addOperatorListener(this, name, dataref(this, name).values, handler);\n};\n\nprototype.removeDataListener = function(name, handler) {\n  return removeOperatorListener(this, dataref(this, name).values, handler);\n};\n\nprototype.preventDefault = function(_) {\n  if (arguments.length) {\n    this._preventDefault = _;\n    return this;\n  } else {\n    return this._preventDefault;\n  }\n};\n\nprototype.timer = timer;\nprototype.events = events;\nprototype.finalize = finalize;\nprototype.hover = hover;\n\n// -- DATA ----\nprototype.data = data;\nprototype.change = change;\nprototype.insert = insert;\nprototype.remove = remove;\n\n// -- SCALES --\nprototype.scale = scale;\n\n// -- INITIALIZATION ----\nprototype.initialize = initialize;\n\n// -- HEADLESS RENDERING ----\nprototype.toImageURL = renderToImageURL;\nprototype.toCanvas = renderToCanvas;\nprototype.toSVG = renderToSVG;\n\n// -- SAVE / RESTORE STATE ----\nprototype.getState = getState;\nprototype.setState = setState;\n"]},"metadata":{},"sourceType":"module"}