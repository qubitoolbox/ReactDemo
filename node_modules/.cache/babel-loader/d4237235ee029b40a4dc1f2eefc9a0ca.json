{"ast":null,"code":"import { isNumber } from 'vega-util';\nimport { getViewConfigDiscreteStep } from '../../config';\nimport { getFirstDefined } from '../../util';\nimport { isVgRangeStep } from '../../vega.schema';\nimport { getMarkConfig } from '../common';\nimport * as encode from './encode';\nexport const tick = {\n  vgMark: 'rect',\n  encodeEntry: model => {\n    const {\n      config,\n      markDef\n    } = model;\n    const orient = markDef.orient;\n    const vgSizeChannel = orient === 'horizontal' ? 'width' : 'height';\n    const vgThicknessChannel = orient === 'horizontal' ? 'height' : 'width';\n    return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({}, encode.baseEncodeEntry(model, {\n      align: 'ignore',\n      baseline: 'ignore',\n      color: 'include',\n      orient: 'ignore',\n      size: 'ignore'\n    })), encode.pointPosition('x', model, {\n      defaultPos: 'mid',\n      vgChannel: 'xc'\n    })), encode.pointPosition('y', model, {\n      defaultPos: 'mid',\n      vgChannel: 'yc'\n    })), encode.nonPosition('size', model, {\n      defaultValue: defaultSize(model),\n      vgChannel: vgSizeChannel\n    })), {\n      [vgThicknessChannel]: {\n        value: getFirstDefined(markDef.thickness, config.tick.thickness)\n      }\n    });\n  }\n};\n\nfunction defaultSize(model) {\n  const {\n    config,\n    markDef\n  } = model;\n  const {\n    orient\n  } = markDef;\n  const vgSizeChannel = orient === 'horizontal' ? 'width' : 'height';\n  const scale = model.getScaleComponent(orient === 'horizontal' ? 'x' : 'y');\n  const markPropOrConfig = getFirstDefined(markDef[vgSizeChannel], markDef.size, getMarkConfig('size', markDef, config, {\n    vgChannel: vgSizeChannel\n  }), config.tick.bandSize);\n\n  if (markPropOrConfig !== undefined) {\n    return markPropOrConfig;\n  } else {\n    const scaleRange = scale ? scale.get('range') : undefined;\n\n    if (scaleRange && isVgRangeStep(scaleRange) && isNumber(scaleRange.step)) {\n      return scaleRange.step * 3 / 4;\n    }\n\n    const defaultViewStep = getViewConfigDiscreteStep(config.view, vgSizeChannel);\n    return defaultViewStep * 3 / 4;\n  }\n}","map":{"version":3,"sources":["../../../../src/compile/mark/tick.ts"],"names":[],"mappings":"AAAA,SAAQ,QAAR,QAAuB,WAAvB;AACA,SAAQ,yBAAR,QAAwC,cAAxC;AACA,SAAQ,eAAR,QAA8B,YAA9B;AACA,SAAQ,aAAR,QAA4B,mBAA5B;AACA,SAAQ,aAAR,QAA4B,WAA5B;AAGA,OAAO,KAAK,MAAZ,MAAwB,UAAxB;AAEA,OAAO,MAAM,IAAI,GAAiB;AAChC,EAAA,MAAM,EAAE,MADwB;AAGhC,EAAA,WAAW,EAAG,KAAD,IAAqB;AAChC,UAAM;AAAC,MAAA,MAAD;AAAS,MAAA;AAAT,QAAoB,KAA1B;AACA,UAAM,MAAM,GAAG,OAAO,CAAC,MAAvB;AAEA,UAAM,aAAa,GAAG,MAAM,KAAK,YAAX,GAA0B,OAA1B,GAAoC,QAA1D;AACA,UAAM,kBAAkB,GAAG,MAAM,KAAK,YAAX,GAA0B,QAA1B,GAAqC,OAAhE;AAEA,WAAA,MAAA,CAAA,MAAA,CAAA,MAAA,CAAA,MAAA,CAAA,MAAA,CAAA,MAAA,CAAA,MAAA,CAAA,MAAA,CAAA,MAAA,CAAA,MAAA,CAAA,EAAA,EACK,MAAM,CAAC,eAAP,CAAuB,KAAvB,EAA8B;AAC/B,MAAA,KAAK,EAAE,QADwB;AAE/B,MAAA,QAAQ,EAAE,QAFqB;AAG/B,MAAA,KAAK,EAAE,SAHwB;AAI/B,MAAA,MAAM,EAAE,QAJuB;AAK/B,MAAA,IAAI,EAAE;AALyB,KAA9B,CADL,CAAA,EASK,MAAM,CAAC,aAAP,CAAqB,GAArB,EAA0B,KAA1B,EAAiC;AAAC,MAAA,UAAU,EAAE,KAAb;AAAoB,MAAA,SAAS,EAAE;AAA/B,KAAjC,CATL,CAAA,EAUK,MAAM,CAAC,aAAP,CAAqB,GAArB,EAA0B,KAA1B,EAAiC;AAAC,MAAA,UAAU,EAAE,KAAb;AAAoB,MAAA,SAAS,EAAE;AAA/B,KAAjC,CAVL,CAAA,EAaK,MAAM,CAAC,WAAP,CAAmB,MAAnB,EAA2B,KAA3B,EAAkC;AACnC,MAAA,YAAY,EAAE,WAAW,CAAC,KAAD,CADU;AAEnC,MAAA,SAAS,EAAE;AAFwB,KAAlC,CAbL,CAAA,EAgBI;AACF,OAAC,kBAAD,GAAsB;AAAC,QAAA,KAAK,EAAE,eAAe,CAAC,OAAO,CAAC,SAAT,EAAoB,MAAM,CAAC,IAAP,CAAY,SAAhC;AAAvB;AADpB,KAhBJ,CAAA;AAmBD;AA7B+B,CAA3B;;AAgCP,SAAS,WAAT,CAAqB,KAArB,EAAqC;AACnC,QAAM;AAAC,IAAA,MAAD;AAAS,IAAA;AAAT,MAAoB,KAA1B;AACA,QAAM;AAAC,IAAA;AAAD,MAAW,OAAjB;AAEA,QAAM,aAAa,GAAG,MAAM,KAAK,YAAX,GAA0B,OAA1B,GAAoC,QAA1D;AACA,QAAM,KAAK,GAAG,KAAK,CAAC,iBAAN,CAAwB,MAAM,KAAK,YAAX,GAA0B,GAA1B,GAAgC,GAAxD,CAAd;AAEA,QAAM,gBAAgB,GAAG,eAAe,CACtC,OAAO,CAAC,aAAD,CAD+B,EAEtC,OAAO,CAAC,IAF8B,EAGtC,aAAa,CAAC,MAAD,EAAS,OAAT,EAAkB,MAAlB,EAA0B;AAAC,IAAA,SAAS,EAAE;AAAZ,GAA1B,CAHyB,EAItC,MAAM,CAAC,IAAP,CAAY,QAJ0B,CAAxC;;AAOA,MAAI,gBAAgB,KAAK,SAAzB,EAAoC;AAClC,WAAO,gBAAP;AACD,GAFD,MAEO;AACL,UAAM,UAAU,GAAG,KAAK,GAAG,KAAK,CAAC,GAAN,CAAU,OAAV,CAAH,GAAwB,SAAhD;;AACA,QAAI,UAAU,IAAI,aAAa,CAAC,UAAD,CAA3B,IAA2C,QAAQ,CAAC,UAAU,CAAC,IAAZ,CAAvD,EAA0E;AACxE,aAAQ,UAAU,CAAC,IAAX,GAAkB,CAAnB,GAAwB,CAA/B;AACD;;AAED,UAAM,eAAe,GAAG,yBAAyB,CAAC,MAAM,CAAC,IAAR,EAAc,aAAd,CAAjD;AAEA,WAAQ,eAAe,GAAG,CAAnB,GAAwB,CAA/B;AACD;AACF","sourcesContent":["import {isNumber} from 'vega-util';\nimport {getViewConfigDiscreteStep} from '../../config';\nimport {getFirstDefined} from '../../util';\nimport {isVgRangeStep} from '../../vega.schema';\nimport {getMarkConfig} from '../common';\nimport {UnitModel} from '../unit';\nimport {MarkCompiler} from './base';\nimport * as encode from './encode';\n\nexport const tick: MarkCompiler = {\n  vgMark: 'rect',\n\n  encodeEntry: (model: UnitModel) => {\n    const {config, markDef} = model;\n    const orient = markDef.orient;\n\n    const vgSizeChannel = orient === 'horizontal' ? 'width' : 'height';\n    const vgThicknessChannel = orient === 'horizontal' ? 'height' : 'width';\n\n    return {\n      ...encode.baseEncodeEntry(model, {\n        align: 'ignore',\n        baseline: 'ignore',\n        color: 'include',\n        orient: 'ignore',\n        size: 'ignore'\n      }),\n\n      ...encode.pointPosition('x', model, {defaultPos: 'mid', vgChannel: 'xc'}),\n      ...encode.pointPosition('y', model, {defaultPos: 'mid', vgChannel: 'yc'}),\n\n      // size / thickness => width / height\n      ...encode.nonPosition('size', model, {\n        defaultValue: defaultSize(model),\n        vgChannel: vgSizeChannel\n      }),\n      [vgThicknessChannel]: {value: getFirstDefined(markDef.thickness, config.tick.thickness)}\n    };\n  }\n};\n\nfunction defaultSize(model: UnitModel): number {\n  const {config, markDef} = model;\n  const {orient} = markDef;\n\n  const vgSizeChannel = orient === 'horizontal' ? 'width' : 'height';\n  const scale = model.getScaleComponent(orient === 'horizontal' ? 'x' : 'y');\n\n  const markPropOrConfig = getFirstDefined(\n    markDef[vgSizeChannel],\n    markDef.size,\n    getMarkConfig('size', markDef, config, {vgChannel: vgSizeChannel}),\n    config.tick.bandSize\n  );\n\n  if (markPropOrConfig !== undefined) {\n    return markPropOrConfig;\n  } else {\n    const scaleRange = scale ? scale.get('range') : undefined;\n    if (scaleRange && isVgRangeStep(scaleRange) && isNumber(scaleRange.step)) {\n      return (scaleRange.step * 3) / 4;\n    }\n\n    const defaultViewStep = getViewConfigDiscreteStep(config.view, vgSizeChannel);\n\n    return (defaultViewStep * 3) / 4;\n  }\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}